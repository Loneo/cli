---
import { getConfigFile } from '../utils/config';

const { pathname } = Astro.url;
const config = await getConfigFile();

// Clean up pathname (remove trailing slash for matching)
const currentSlug = pathname.replace(/^\/|\/$/g, '');

// Flatten all sidebar items into a single list of pages with their labels
let allPages: { label: string; href: string; normalizedPath: string; group?: string }[] = [];

for (const group of config.navigation.sidebar) {
  if (group.items) {
    for (const item of group.items) {
       // Handle slashes in slug/href comparison
       const itemPath = item.href || item.slug || '';
       allPages.push({
        label: item.label,
        href: itemPath,
        normalizedPath: itemPath.replace(/^\/|\/$/g, ''),
        group: group.label,
      });
    }
  }
}

// Find current page index
const currentIndex = allPages.findIndex((page) => page.normalizedPath === currentSlug);

// Get prev and next pages
const prevPage = currentIndex > 0 ? allPages[currentIndex - 1] : null;
const nextPage = currentIndex < allPages.length - 1 ? allPages[currentIndex + 1] : null;
---

{(prevPage || nextPage) && (
  <nav class="prev-next-nav" aria-label="Page navigation">
    <div class="prev-next-container">
      {prevPage ? (
        <a href={prevPage.href} class="prev-next-link prev">
          <span class="prev-next-direction">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m15 18-6-6 6-6"/>
            </svg>
            Previous
          </span>
          <span class="prev-next-title">{prevPage.label}</span>
        </a>
      ) : (
        <div></div>
      )}
      
      {nextPage ? (
        <a href={nextPage.href} class="prev-next-link next">
          <span class="prev-next-direction">
            Next
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m9 18 6-6-6-6"/>
            </svg>
          </span>
          <span class="prev-next-title">{nextPage.label}</span>
        </a>
      ) : (
        <div></div>
      )}
    </div>
  </nav>
)}

<style>
  @reference "../styles/global.css";
  .prev-next-nav {
    @apply mt-12 pt-6 border-t border-border;
  }
  
  .prev-next-container {
    @apply flex justify-between gap-4;
  }
  
  .prev-next-link {
    @apply flex flex-col gap-1 px-4 py-3 rounded border border-border;
    @apply bg-card hover:bg-accent transition-colors duration-200;
    @apply max-w-[45%];
  }
  
  .prev-next-link.prev {
    @apply items-start text-left;
  }
  
  .prev-next-link.next {
    @apply items-end text-right ml-auto;
  }
  
  .prev-next-direction {
    @apply flex items-center gap-1 text-xs font-medium text-muted-foreground uppercase tracking-wider;
  }
  
  .prev-next-title {
    @apply text-sm font-semibold text-foreground line-clamp-1;
  }
</style>
