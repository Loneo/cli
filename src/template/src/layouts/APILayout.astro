---
import Layout from './Layout.astro';
import APIPlayground from '../components/APIPlayground.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  frontmatter?: {
    api?: string;
    title?: string;
    description?: string;
  };
}

const { frontmatter } = Astro.props;
const title = Astro.props.title || frontmatter?.title;
const description = Astro.props.description || frontmatter?.description;

// Parse API string "GET /path"
let method = 'GET';
let path = '/';
if (frontmatter?.api) {
  const parts = frontmatter.api.split(' ');
  if (parts.length >= 2) {
    method = parts[0];
    path = parts[1];
  } else {
    path = parts[0];
  }
}
---

<Layout title={title} description={description}>
  <main class="api-main-content">
    <div class="api-content-wrapper">
      <!-- Center: Documentation Prose -->
      <article class="api-prose">
        <h1 class="text-3xl font-bold mb-4">{title}</h1>
        {description && <p class="text-lg text-muted-foreground mb-8">{description}</p>}
        <slot />
      </article>
      
      <!-- Right: API Playground/Examples -->
      <aside class="api-sidebar-right">
          <APIPlayground method={method} path={path} />
      </aside>
    </div>
  </main>
</Layout>

<style>
  @reference '../styles/global.css';
  .api-main-content {
    @apply min-h-screen flex flex-col flex-1 mt-24;
    margin-left: 0;
  }
  
  @media (min-width: 768px) {
    .api-main-content {
      margin-left: 18rem; /* Match global sidebar width */
    }
  }
  
  .api-content-wrapper {
    @apply flex flex-col lg:flex-row max-w-full;
  }
  
  /* Center Column */
  .api-prose {
    @apply prose prose-slate dark:prose-invert max-w-none p-6 lg:p-10 flex-1;
    /* Limit width to readable measure only if not constrained by flex */
    min-width: 0; 
  }
  
  /* Right Column */
  .api-sidebar-right {
    @apply w-full lg:w-[400px] xl:w-[450px] p-6 lg:p-8 bg-muted/10 border-l border-border min-h-[calc(100vh-4rem)];
  }

  /* Responsive adjustments */
  @media (max-width: 1023px) {
    .api-sidebar-right {
      @apply border-l-0 border-t;
      min-height: auto;
    }
  }
</style>
